---
title: "Sum.GapFill"
author: "Azura Liu"
date: '2022-03-22'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("dplyr")
library("tidyverse")
library("lubridate")

getwd()
Sap1<-read.csv("../Data/Processed/Daytime/Sapflux/raw/Sap1.7.csv")
Sap2<-read.csv("../Data/Processed/Daytime/Sapflux/raw/Sap2.7.csv")
Sap3<-read.csv("../Data/Processed/Daytime/Sapflux/raw/Sap3.7.csv")
Sap4<-read.csv("../Data/Processed/Daytime/Sapflux/raw/Sap4.7.csv")

Sap1$Date<-as.Date(Sap1$Date, format = "%m/%d/%Y")
Sap2$Date<-as.Date(Sap2$Date, format = "%m/%d/%Y")
Sap3$Date<-as.Date(Sap3$Date, format = "%m/%d/%Y")
Sap4$Date<-as.Date(Sap4$Date, format = "%m/%d/%Y")

Sap1<-Sap1%>%mutate_if(is.character, as.numeric)
Sap2<-Sap2%>%mutate_if(is.character, as.numeric)
Sap3<-Sap3%>%mutate_if(is.character, as.numeric)
Sap4<-Sap4%>%mutate_if(is.character, as.numeric)
```

```{r 24hr}
Sap1.24<-aggregate(Sap1[,c(5,7:38)], by = list(Sap1$Date, Sap1$DOY),FUN = "sum")%>%
  mutate(Interval = "24hr")%>%
  select(1,2,36,3:35)
names(Sap1.24)[1]<-"Date"
names(Sap1.24)[2]<-"DOY"

Sap2.24<-aggregate(Sap2[,c(5,7:38)], by = list(Sap2$Date, Sap2$DOY),FUN = "sum")%>%
  mutate(Interval = "24hr")%>%
  select(1,2,36,3:35)
names(Sap2.24)[1]<-"Date"
names(Sap2.24)[2]<-"DOY"

Sap3.24<-aggregate(Sap3[,c(5,7:38)], by = list(Sap3$Date, Sap3$DOY),FUN = "sum")%>%
  mutate(Interval = "24hr")%>%
  select(1,2,36,3:35)
names(Sap3.24)[1]<-"Date"
names(Sap3.24)[2]<-"DOY"

Sap4.24<-aggregate(Sap4[,c(5,7:38)], by = list(Sap4$Date, Sap4$DOY),FUN = "sum")%>%
  mutate(Interval = "24hr")%>%
  select(1,2,36,3:35)
names(Sap4.24)[1]<-"Date"
names(Sap4.24)[2]<-"DOY"
```

```{r assign dn}
Sap1$PAR <- gsub(1000,"Day",Sap1$PAR)
Sap1$PAR <- gsub(0,"Night",Sap1$PAR)

Sap2$PAR <- gsub(1000,"Day",Sap2$PAR)
Sap2$PAR <- gsub(0,"Night",Sap2$PAR)

Sap3$PAR <- gsub(1000,"Day",Sap3$PAR)
Sap3$PAR <- gsub(0,"Night",Sap3$PAR)

Sap4$PAR <- gsub(1000,"Day",Sap4$PAR)
Sap4$PAR <- gsub(0,"Night",Sap4$PAR)
```

```{r sum dn}
VPD<-aggregate(Sap1$VPD, by=list(Sap1$DOY,Sap1$PAR), mean)
  names(VPD)[1]<-"DOY"
  names(VPD)[2]<-"Interval"
  names(VPD)[3]<-"VPD"
  
Sap1.dn<-aggregate(Sap1[,c(7:38)], by = list(Sap1$Date,Sap1$DOY, Sap1$PAR),FUN = "sum")
names(Sap1.dn)[1]<-"Date"
names(Sap1.dn)[2]<-"DOY"
names(Sap1.dn)[3]<-"Interval"
Sap1.dn<-inner_join(VPD, Sap1.dn, by=c("DOY","Interval"))

Sap2.dn<-aggregate(Sap2[,c(7:38)], by = list(Sap2$Date,Sap2$DOY, Sap2$PAR),FUN = "sum")
names(Sap2.dn)[1]<-"Date"
names(Sap2.dn)[2]<-"DOY"
names(Sap2.dn)[3]<-"Interval"
Sap2.dn<-inner_join(VPD, Sap2.dn, by=c("DOY","Interval"))


Sap3.dn<-aggregate(Sap2[,c(7:38)], by = list(Sap2$Date,Sap2$DOY, Sap2$PAR),FUN = "sum")
names(Sap3.dn)[1]<-"Date"
names(Sap3.dn)[2]<-"DOY"
names(Sap3.dn)[3]<-"Interval"
Sap3.dn<-inner_join(VPD, Sap3.dn, by=c("DOY","Interval"))

Sap4.dn<-aggregate(Sap4[,c(7:38)], by = list(Sap4$Date,Sap4$DOY, Sap4$PAR),FUN = "sum")
names(Sap4.dn)[1]<-"Date"
names(Sap4.dn)[2]<-"DOY"
names(Sap4.dn)[3]<-"Interval"
Sap4.dn<-inner_join(VPD, Sap4.dn, by=c("DOY","Interval"))

```



```{r combine}
Sap1.Sum<-filter(Sap1.dn,Interval == "Day")
Sap2.Sum<-filter(Sap2.dn,Interval == "Day")
Sap3.Sum<-filter(Sap3.dn,Interval == "Day")
Sap4.Sum<-filter(Sap4.dn,Interval == "Day")
```


```{r conversion}

library(dplyr)
Converted1<- Sap1.Sum %>% 
  mutate_at(vars(5:36),
            .funs = funs((.*15*60) /1000))

Converted2<- Sap2.Sum %>% 
  mutate_at(vars(5:36),
            .funs = funs((.*15*60) /1000))

Converted3<- Sap3.Sum %>% 
  mutate_at(vars(5:36),
            .funs = funs((.*15*60) /1000))

Converted4<- Sap4.Sum %>% 
  mutate_at(vars(5:36),
            .funs = funs((.*15*60) /1000))
```
```{r}
write.csv(Converted1, row.names = FALSE, file ="../Data/Processed/Daytime/Sapflux/converted/Sap1.7.csv")
write.csv(Converted2, row.names = FALSE, file ="../Data/Processed/Daytime/Sapflux/converted/Sap2.7.csv")
write.csv(Converted3, row.names = FALSE, file ="../Data/Processed/Daytime/Sapflux/converted/Sap3.7.csv")
write.csv(Converted4, row.names = FALSE, file ="../Data/Processed/Daytime/Sapflux/converted/Sap4.7.csv")


```

